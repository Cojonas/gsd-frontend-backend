sudo: required
language: node_js
node_js: 
  - "8"
services: docker
before_install:
  - docker build -t gsd-frontend-backend .
script:
  - "cd server && npm i"
  - "npm test"
  - "npm build"
  - "cd ../client && npm i && npm run build"
  - "cd ../server/public && mkdir appfiles && cp -r ../../client/build/* ./appfiles && ls"

deploy:
  provider: releases
  api_key: 7a3f6c5dca034e597ac68a6d09e5b41d238f0114
  file: "dockercontainer_image"
  skip_cleanup: true
  on:
    tags: true
on:
  branch: master